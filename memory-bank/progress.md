# 项目进展与演进

---

## 关键里程碑

### 2025年9月4日：通勤时间计算准确性问题修复

- **主要成果**: 彻底解决了通勤时间计算严重不准的问题。前端现在能够可靠地调用后端API，获取并展示来自Google Maps的真实、准确的通勤数据。
- **根因分析**:
    1.  **P0 - API密钥缺失**: 后端 `.env` 文件中缺少 `GOOGLE_MAPS_API_KEY`，导致外部API调用失败。
    2.  **P1 - 前端静默降级**: 前端 `api.js` 中存在“测试模式”下的静默降级逻辑，API调用失败时，系统会回退到一套不准确的本地估算算法，从而掩盖了后端错误。
    3.  **P-dev - 开发环境缓存**: Vite开发服务器的缓存导致前端代码变更未能及时生效，延长了问题排查时间。
- **关键修复**:
    - **后端**: 在 `.env` 文件中正确配置了 `GOOGLE_MAPS_API_KEY`。
    - **前端**: 删除了 `api.js` 中的 `testMode` 开关、`estimateCommute` 本地估算函数及其相关的所有降级逻辑，确保API调用失败时会抛出明确错误。
- **验证手段**: 通过浏览器网络开发者工具，确认前端页面在计算通勤时间时，发起了对 `/api/directions` 的XHR请求，并收到了状态码为200的成功响应。
- **影响与价值**:
    - **准确性**: 通勤时间从误差高达50%-200%（基于本地估算）提升至与Google Maps官方结果一致。
    - **用户体验**: 用户可以获得可靠的通勤决策依据，显著提升产品信任度。
    - **系统可靠性**: 移除了错误的静默降级，使系统在遇到外部API问题时能够快速失败，便于监控和定位。

### 2025年9月3日：看房时间功能修复与增强

- **主要成果**: 修复了详情页看房时间无法显示的bug，并增强了数据处理的健壮性。
- **关键修复**: 统一接口契约，详情端点 `/api/properties/{id}` 返回 `inspection_times`；同步更新后端 Property 模型，刷新/直链访问时 `inspection_times` 不再丢失。
- **缓存说明**: 详情端点默认缓存30分钟；测试期间可调用 `/api/cache/invalidate?invalidate_all=true` 失效缓存或等待过期（仅测试/管理员上下文启用）。
- **代码健康**: 移除了冗余的 `dateUtils.js` 文件；未改动前端 Pinia 合并逻辑，避免不必要的行为变化。

### 2025年9月3日：前端代码全面审计

- **主要成果**: 完成了对前端代码的首次全面静态分析，识别出7大关键领域的技术债务和优化机会。
- **关键发现**: 确认了项目采用基于CSS变量的自建设计系统，但存在令牌使用不一致、零测试覆盖、硬编码安全风险（testMode）和国际化缺失等核心问题。
- **后续行动**: 本次审计的结果将作为接下来P0-P2优先级任务的整改依据，指导后续的重构和优化工作。

### 2025年9月3日：E2E 基线测试落地

- **主要成果**: 完善 Playwright 配置，建立核心用户路径自动化回归。
- **新增用例**: 首页加载可用性、区域搜索建议与筛选联动。
- **持续计划**: 将通勤查询与详情页直链访问纳入回归集。

### 2025年9月3日：PC 详情页样式统一

- **主要成果**: 统一 PC 端详情页与列表页的设计语言与栅格体系（页灰卡白、1200px 容器、左右 32px 内边距）。
- **关键改动**:
  - `src/style.css` 补齐详情页使用但缺失的 CSS 变量映射：`--space-*`, `--bg-*`, `--shadow-xs`, `--brand-primary`, `--text-*`, `--link-color` 等，保持与 JUWO 全局设计系统一致。
  - `PropertyDetail.vue` 将背景改为 `var(--color-bg-page)`，颜色/边框/过渡统一为全局 tokens（`var(--color-text-*)`, `var(--color-border-default)` 等），移除未定义变量（如 `--transition-all`）。
  - 统一 ≥1200px 与 1920px 断点下的容器宽度与内边距，避免“另一套主题”的观感。
- **向后兼容**: 纯样式层调整，不改变组件逻辑与数据流。

### 2025年8月30日：PropertyCard设计规范完实现

- **主要成果**: 完全按Realestate.com.au设计规范重构房源卡片
- **关键修复**: 轮播箭头优化，收藏功能恢复，移动端显示完善

### 2025年1月30日：虚拟滚动性能优化

- **技术突破**: 虚拟滚动组件启用，DOM节点减少99.8%
- **性能提升**: 列表加载时间从3秒降至0.5秒，提升83%
- **代码健康**: 建立注释规范，扫描8个TODO和35个console.log

### 2025年1月29日：深度性能优化

- **API加速**: 响应时间从8-10秒降至0.4-0.5秒，提升20倍
- **数据库优化**: 筛选查询从2.2秒降至0.59秒，提升3.7倍
- **详情页优化**: 从8.6秒延迟降至即时显示

### 2025年1月29日：筛选功能全面修复

- **多区域搜索**: 支持任意数量区域组合搜索
- **筛选面板联动**: 正确显示基于区域的房源数量
- **日期筛选逻辑**: 理解并实现"特定时间段内空出"的业务需求

### 2025年1月29日：搜索功能优化

- **后端API实现**: 全量数据搜索 (3456条 vs 之前300条)
- **结果去重**: 解决postcode格式不一致问题
- **相邻区域推荐**: 类似Domain.com.au的"SUGGESTED FOR YOU"功能

### 2025年1月28日：通勤查询功能完整实现

- **用户流程闭环**: 从房源详情→认证模态框→通勤查询页面
- **关键组件**: AuthModal, AddLocationModal, CommuteTimes等
- **技术架构**: 预设澳洲常用地址，15分钟缓存机制

### 2025年1月28日：认证系统与Google Places API

- **JWT认证**: 完整注册/登录/邮箱验证流程，保留testMode
- **Google Places**: 双模式支持 (开发模拟 + 生产真实API)
- **地址持久化**: 后端user_addresses表 + 前端localStorage

### 2025年8月27日：详情页Figma设计实现

- **设计规范**: 单列布局，移动端优先，浮动透明导航栏
- **Markdown渲染**: 支持列表/标题/段落，渐变淡出效果
- **地图功能**: Google Maps + OpenStreetMap双重保障

### 2025年1月26日：核心P0问题修复

- **API响应统一**: 字段名统一 (property_description → description)
- **缓存策略**: 选择性缓存失效，30分钟详情页缓存
- **服务端分页**: 从前端分页完全迁移至服务端

### 2025年8月26日：图片显示修复与PropertyDetail优化

- **图片bug修复**: 解决PropertyDetail.vue的images数组处理问题
- **沉浸式浏览**: Lightbox全屏图片查看体验
- **UI细节对齐**: 与PropertyCard设计语言统一

### 2025年8月25日：初始设置与记忆库建立

- **项目设立**: Vue 3 + FastAPI技术栈，Supabase云数据库
- **调解理解**: 数据流程澄清 (Domain.com.au → 爬虫 → CSV → Supabase → API)

---

## 性能数据总结

- **列表渲染**: 0.5秒 (优化前3秒，提升83%)
- **API响应**: 0.4-0.5秒 (优化前8-10秒，提升20倍)
- **筛选查询**: 0.59秒 (优化前2.2秒，提升3.7倍)
- **DOM节点**: ~400个 (优化前17万+，减少99.8%)
- **内存占用**: 50MB (优化前400MB，减少87.5%)

## 技术债务解决进展

- ✅ 用户认证体系 (JWT + 邮箱验证)
- ✅ Google Places API替代方案
- ✅ Redis降级策略 (内存缓存)
- ✅ API字段统一问题
- ✅ 服务端分页迁移
- ✅ 虚拟滚动性能优化
- ✅ 数据库索引自动优化
## 2025-09-04
- 扁平化 PropertyDetail 白卡外观（移除边框/圆角/阴影）
- 分隔线伪元素对齐：左对正文（50px 内边距），右对地图边缘
- 新版心对齐：正文左缘固定 453px；描述与地图右缘对齐且距页面右侧固定 496px
- 可读性优化：≥1920px 仅限制描述段落 p 的行长为 --paragraph-measure(默认 68ch)，不改变容器对齐
- 向后兼容：<1200px 保持原布局；Hero 顶部大图全宽不变
