# Sydney Rental Hub - AI协作工作流规则

> **重要**：此文档定义了AI助手必须遵循的工作流程
> **优先级**：最高 - 覆盖所有其他指令

---

## 🚨 核心原则：避免"兔子洞"

**定义**：兔子洞 = AI基于片面理解做出假设，导致连锁错误

**预防措施**：

1. **禁止假设** - 不确定时必须检查实际代码
2. **禁止经验主义** - 不能基于"通常是这样"来编码
3. **强制验证** - 每个改动必须立即测试

---

## 📋 标准工作流程

### Phase 1: 任务理解（5分钟）

```
1. 读取 memory-bank/INDEX.md
2. 读取 memory-bank/activeContext.md  
3. 与用户沟通
4. 复述你的理解，并明确任务范围和影响范围
5. 使用TodoWrite创建任务清单
```

### Phase 2: 调查分析（10分钟）

```
1. 定位相关文件（使用INDEX.md导航）
2. 读取实际代码（不要假设）
3. 检查API文档确认数据格式
4. 记录发现的依赖关系
```

### Phase 3: 实施方案（执行）

```
1. 一次只改一个文件
2. 改动后立即说明改了什么
3. 等待用户验证后再继续
4. 出错时查看INDEX.md的问题定位表
```

### Phase 4: 验证记录（5分钟）

```
1. 验证功能是否正常
2. 更新progress.md（如果是重要变更）
3. 更新activeContext.md（记录新状态）
4. 清理TodoWrite任务
```

---

## 🔧 具体操作规范

### 文件修改规则

```yaml
修改前:
  - 必须先Read文件
  - 确认当前内容
  - 识别依赖关系

修改时:
  - 使用Edit而非Write（除非新文件）
  - 保留原有代码风格
  - 不添加无关注释

修改后:
  - 明确告知改动内容
  - 提示可能的副作用
  - 等待验证反馈
```

### API调用规则

```yaml
前端调用API前:
  - 查看 vue-frontend/API_REFERENCE.md
  - 确认响应格式
  - 检查错误处理

后端修改API前:
  - 查看 backend/API_ENDPOINTS.md
  - 确认前端依赖
  - 保持向后兼容
```

### 调试流程

```yaml
遇到错误时:
  1. 先查 INDEX.md 的"常见问题快速定位"
  2. 再查具体的错误日志
  3. 检查最近的改动
  4. 不要盲目尝试修复
```

---

## 🤖 子代理工作规范

### 创建子代理时必须传递

```markdown
## 项目上下文
- 工作目录: C:\Users\nuoai\Desktop\WEB-sydney-rental-hub
- 主索引: memory-bank/INDEX.md
- 当前状态: memory-bank/activeContext.md

## 必须遵守的规则
1. 读取INDEX.md了解项目结构
2. 不要假设，要检查实际代码
3. 修改前必须Read，修改后必须验证
4. 遇到不确定的情况，返回问题而不是猜测解决
```

### 子代理任务模板

```markdown
任务: [具体任务描述]

背景信息:
- 查看 memory-bank/INDEX.md 了解项目架构
- 相关模块: [指定具体模块]
- 注意事项: [已知的坑和问题]

要求:
1. 先调查，后实施
2. 记录所有发现
3. 一步一验证
4. 返回结构化报告

禁止:
- 基于假设修改代码
- 跳过验证步骤
- 修改超出任务范围的文件
```

---

## 📝 检查清单

### 每次任务开始前

- [ ] 读取了INDEX.md吗？
- [ ] 读取了activeContext.md吗？
- [ ] 创建了TodoWrite任务吗？
- [ ] 明确了影响范围吗？

### 每次修改代码前

- [ ] Read了目标文件吗？
- [ ] 检查了API文档吗？
- [ ] 考虑了依赖关系吗？
- [ ] 告知了用户将要做什么吗？

### 每次任务完成后

- [ ] 功能验证通过了吗？
- [ ] 更新了相关文档吗？
- [ ] 清理了任务列表吗？
- [ ] 记录了重要变更吗？

---

## 🚫 常见错误模式（避免）

1. **模式：直接修改不Read**

   ```
   ❌ "我知道这个文件的结构" -> 直接Edit
   ✅ 先Read确认现状 -> 再Edit
   ```
2. **模式：连锁修改**

   ```
   ❌ 改A -> 改B -> 改C -> 全部出错
   ✅ 改A -> 验证 -> 改B -> 验证 -> 改C
   ```
3. **模式：假设API格式**

   ```
   ❌ "通常API返回{data: ...}" 
   ✅ 查看API_ENDPOINTS.md确认格式
   ```
4. **模式：忽视缓存**

   ```
   ❌ 改了后端API，前端还显示旧数据
   ✅ 记住有15分钟Redis缓存，提醒用户
   ```

---

## 💡 工作智慧

> "不确定时，宁可多问一句，不要自作主张"

> "代码能运行不代表逻辑正确"

> "改一行代码可能影响十个功能"

> "文档是地图，代码是领土，领土永远是真相"

---

**最后提醒**：此工作流是活文档，发现新的最佳实践时应及时更新。
