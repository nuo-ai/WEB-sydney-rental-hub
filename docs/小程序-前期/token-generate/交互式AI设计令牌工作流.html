<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式AI设计令牌工作流</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 & Element Plus -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        :root {
            --el-color-primary: #409EFF;
            --el-color-success: #67C23A;
            --el-color-warning: #E6A23C;
            --el-color-danger: #F56C6C;
            --el-color-info: #909399;
            --el-text-color-primary: #303133;
            --el-bg-color-page: #f2f3f5;
            --el-border-color: #dcdfe6;
            --el-border-radius-base: 4px;
            --el-box-shadow-light: 0px 0px 12px rgba(0, 0, 0, 0.12);
        }

        html.dark {
            --el-color-primary: #79bbff;
            --el-color-success: #95d475;
            --el-color-warning: #eebe77;
            --el-color-danger: #f89898;
            --el-color-info: #b1b3b8;
            --el-text-color-primary: #e5eaf3;
            --el-bg-color-page: #0a0a0a;
            --el-border-color: #4c4d4f;
            --el-border-radius-base: 4px;
            --el-box-shadow-light: 0px 0px 12px rgba(0, 0, 0, 0.36);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #111827;
            color: #d1d5db;
        }

        html {
            -webkit-text-size-adjust: 100%; /* Fix for browser warning */
        }

        .step-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            transition: all 0.3s ease;
        }

        .step-card h2 {
            color: #93c5fd;
        }

        .code-block {
            background-color: #282c34;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            overflow-x: auto;
            border: 1px solid #4b5563;
        }
        
        .lucide {
            display: inline-block;
            width: 1em;
            height: 1em;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
        }

        /* Element Plus component overrides for preview */
        .preview-container .el-button {
             margin: 0 8px 8px 0;
        }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="min-h-screen container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">交互式AI设计令牌工作流</h1>
            <p class="text-lg text-gray-400">将您的 Vue 3 + Element Plus 项目提升至专业水准</p>
        </header>

        <main class="space-y-8">
            <!-- Step 1: Foundation -->
            <div class="step-card rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center"><i data-lucide="layers" class="mr-2"></i>Part 1: 奠定基石 - 解构UI语义契约</h2>
                <p class="text-gray-400 mb-6">我们将利用AI逆向工程 Element Plus 的样式系统，定义一个精确、可扩展的“语义契约”，确保我们的设计令牌能够无缝对接。</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold text-white mb-2">AI驱动的审计</h3>
                        <p class="text-sm text-gray-400 mb-4">模拟AI分析 Element Plus 的 `var.scss` 文件，提取所有可用于主题化的CSS自定义属性。</p>
                        <button @click="runScssAnalysis" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i data-lucide="scan-line" class="mr-2"></i> 运行AI分析
                        </button>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white mb-2">分析结果 (JSON)</h3>
                        <pre class="code-block h-48 overflow-auto"><code class="language-json" ref="scssResultBlock">{{ scssAnalysisResult }}</code></pre>
                    </div>
                </div>
            </div>

            <!-- Step 2: AI Co-pilot with Gemini -->
            <div class="step-card rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center"><i data-lucide="bot" class="mr-2"></i>✨ Part 2: AI 创意伙伴 - 智能生成主题</h2>
                <p class="text-gray-400 mb-6">描述您想要的品牌感觉或主题，AI 将为您生成一个完整、和谐的调色板，并解释其设计理念。</p>

                <!-- Gemini Prompt Area -->
                <div class="mb-6">
                    <label for="theme-prompt" class="block font-semibold text-white mb-2">主题描述:</label>
                    <textarea id="theme-prompt" v-model="themePrompt" rows="3" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white placeholder-gray-500 focus:ring-blue-500 focus:border-blue-500" placeholder="例如：一个适合悉尼学生租房应用的，现代、友好且值得信赖的主题"></textarea>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- AI Palette Generation -->
                    <div class="lg:col-span-1">
                        <button @click="askAiForPalette" :disabled="isLoading" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center disabled:bg-gray-500 disabled:cursor-not-allowed">
                            <span v-if="!isLoading" class="flex items-center justify-center"><i data-lucide="sparkles" class="mr-2"></i> 请求 AI 生成调色板</span>
                            <span v-else class="flex items-center justify-center">
                                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                生成中...
                            </span>
                        </button>
                    </div>
                    <!-- Light Theme Generation -->
                    <div class="lg:col-span-1">
                         <h3 class="font-semibold text-white mb-2 sr-only">2. 生成亮色主题</h3>
                         <button @click="generateLightTheme" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                             <i data-lucide="sun" class="mr-2"></i> 重新生成亮色令牌
                         </button>
                    </div>
                    <!-- Dark Theme Generation -->
                    <div class="lg:col-span-1">
                        <h3 class="font-semibold text-white mb-2 sr-only">3. 生成暗色主题</h3>
                        <button @click="generateDarkTheme" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i data-lucide="moon" class="mr-2"></i> 重新生成暗色令牌
                        </button>
                    </div>
                </div>
                
                <!-- AI Rationale -->
                <div v-if="aiRationale" class="mt-6 bg-gray-800 border border-gray-700 rounded-lg p-4">
                    <h3 class="font-semibold text-white mb-2 flex items-center"><i data-lucide="message-square-quote" class="mr-2 text-purple-400"></i>AI 设计理念</h3>
                    <p class="text-gray-300 text-sm whitespace-pre-wrap">{{ aiRationale }}</p>
                </div>

                <!-- JSON Outputs -->
                <div class="mt-6 grid md:grid-cols-3 gap-6">
                    <div>
                        <h3 class="font-semibold text-white mb-2 flex justify-between items-center">
                            品牌色令牌 (brand.json)
                            <input type="color" v-model="brandColor" @input="handleColorPickerChange" class="w-8 h-8 p-1 bg-gray-700 border border-gray-600 rounded-lg cursor-pointer">
                        </h3>
                        <pre class="code-block h-64 overflow-auto"><code class="language-json" ref="brandPaletteBlock">{{ brandPaletteResult }}</code></pre>
                    </div>
                     <div>
                        <h3 class="font-semibold text-white mb-2">亮色主题 (light.json)</h3>
                        <pre class="code-block h-64 overflow-auto"><code class="language-json" ref="lightThemeBlock">{{ lightThemeResult }}</code></pre>
                    </div>
                     <div>
                        <h3 class="font-semibold text-white mb-2">暗色主题 (dark.json)</h3>
                        <pre class="code-block h-64 overflow-auto"><code class="language-json" ref="darkThemeBlock">{{ darkThemeResult }}</code></pre>
                    </div>
                </div>
            </div>


            <!-- Step 3 & 4: Engine & Integration & Preview -->
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Step 3: Engine -->
                <div class="step-card rounded-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 flex items-center"><i data-lucide="settings-2" class="mr-2"></i>Part 3: 转换引擎 - 配置</h2>
                    <p class="text-gray-400 mb-6">配置 Style Dictionary 自动化流程，它将读取JSON源文件，并转换为Vue应用可用的CSS文件。</p>
                    <h3 class="font-semibold text-white mb-2">构建脚本 (build-tokens.js)</h3>
                    <pre class="code-block h-96 overflow-auto"><code class="language-javascript" ref="buildScriptBlock">
const StyleDictionary = require('style-dictionary');

function getStyleDictionaryConfig(theme) {
  const isDarkTheme = theme === 'dark';
  return {
    source: [
      'tokens/base/**/*.json',
      `tokens/themes/${theme}.json`
    ],
    platforms: {
      css: {
        transformGroup: 'css',
        buildPath: 'src/styles/generated/',
        prefix: 'el',
        files: [{
          destination: `theme-${theme}.css`,
          format: 'css/variables',
          options: {
            selector: isDarkTheme ? 'html.dark' : ':root',
            outputReferences: true,
          },
        }],
      }
    }
  };
}

['light', 'dark'].forEach(theme => {
  console.log(`Building ${theme} theme...`);
  const sd = StyleDictionary.extend(getStyleDictionaryConfig(theme));
  sd.buildAllPlatforms();
});

console.log('Build completed!');
                    </code></pre>
                </div>
                
                <!-- Step 4: Integration & Preview -->
                <div class="step-card rounded-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 flex items-center"><i data-lucide="eye" class="mr-2"></i>Part 4: 应用与集成 - 实时预览</h2>
                    <p class="text-gray-400 mb-6">将生成的令牌应用到组件中，并实时预览主题切换效果。预览区的组件样式完全由你生成的令牌驱动。</p>
                    <div id="preview-app" class="preview-container bg-gray-800 border border-gray-700 rounded-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-semibold text-white">组件预览</h3>
                            <div class="flex items-center gap-2">
                                <i data-lucide="sun" class="text-gray-400"></i>
                                <el-switch
                                  v-model="isDarkMode"
                                  @change="toggleTheme"
                                  inline-prompt
                                  active-text="暗"
                                  inactive-text="亮"
                                />
                                <i data-lucide="moon" class="text-gray-400"></i>
                            </div>
                        </div>

                        <div>
                            <p class="text-sm text-gray-300 mb-2">Element Plus 组件</p>
                            <el-button type="primary">Primary</el-button>
                            <el-button type="success">Success</el-button>
                            <el-button type="danger">Danger</el-button>
                            <el-input v-model="inputValue" placeholder="请输入..." class="mt-2"></el-input>
                        </div>

                        <div class="mt-6">
                            <p class="text-sm text-gray-300 mb-2">自定义组件</p>
                            <div class="custom-card">
                                这是一个自定义卡片。它的背景、文字、边框和阴影都来自于设计令牌。
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <footer class="text-center mt-12 text-gray-500">
            <p>为你的下一个伟大项目构建坚实的设计基础。</p>
        </footer>
    </div>
    
    <style id="light-theme-styles"></style>
    <style id="dark-theme-styles"></style>

    <script type="module">
        const { createApp, ref, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const brandColor = ref('#409EFF');
                const scssAnalysisResult = ref("点击左侧按钮开始分析...");
                const brandPaletteResult = ref("在此处生成品牌色...");
                const lightThemeResult = ref("在此处生成亮色主题...");
                const darkThemeResult = ref("在此处生成暗色主题...");
                
                // Gemini API refs
                const themePrompt = ref('一个适合悉尼学生租房应用的，现代、友好且值得信赖的主题');
                const aiRationale = ref('');
                const isLoading = ref(false);
                const aiPalette = ref(null);

                // --- Helper Functions ---
                function highlightBlock(ref) {
                    nextTick(() => {
                        if (ref.value) {
                            hljs.highlightElement(ref.value);
                        }
                    });
                }
                
                // --- NEW: Stable Color Manipulation Functions ---
                const tint = (hex, factor) => {
                    if (!hex) return '';
                    let r = parseInt(hex.slice(1, 3), 16);
                    let g = parseInt(hex.slice(3, 5), 16);
                    let b = parseInt(hex.slice(5, 7), 16);
                    r = Math.round(r + (255 - r) * factor);
                    g = Math.round(g + (255 - g) * factor);
                    b = Math.round(b + (255 - b) * factor);
                    return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
                };

                const shade = (hex, factor) => {
                    if (!hex) return '';
                    let r = parseInt(hex.slice(1, 3), 16);
                    let g = parseInt(hex.slice(3, 5), 16);
                    let b = parseInt(hex.slice(5, 7), 16);
                    r = Math.round(r * (1 - factor));
                    g = Math.round(g * (1 - factor));
                    b = Math.round(b * (1 - factor));
                    return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
                };


                // --- Method Implementations ---
                const scssResultBlock = ref(null);
                const runScssAnalysis = () => {
                    const result = {
                      "colors": [
                        { "scss_key": "primary.base", "css_variable": "--el-color-primary" },
                        { "scss_key": "success.base", "css_variable": "--el-color-success" },
                        { "scss_key": "warning.base", "css_variable": "--el-color-warning" },
                        { "scss_key": "danger.base", "css_variable": "--el-color-danger" },
                        { "scss_key": "info.base", "css_variable": "--el-color-info" }
                      ],
                      "text-color": [{ "scss_key": "primary", "css_variable": "--el-text-color-primary" }],
                      "background-color": [{ "scss_key": "page", "css_variable": "--el-bg-color-page" }],
                      "border": [{ "scss_key": "color.base", "css_variable": "--el-border-color" }]
                    };
                    scssAnalysisResult.value = JSON.stringify(result, null, 2);
                    highlightBlock(scssResultBlock);
                };
                
                const brandPaletteBlock = ref(null);
                const generateBrandPalette = () => {
                    const base = brandColor.value;
                     if (!base || !/^#[0-9a-fA-F]{6}$/.test(base)) {
                        console.error("Invalid base color for palette generation:", base);
                        return;
                    }
                    const palette = {
                      "color": { "brand": { "primary": {
                        "50": { "value": tint(base, 0.9) },
                        "100": { "value": tint(base, 0.8) },
                        "200": { "value": tint(base, 0.6) },
                        "300": { "value": tint(base, 0.4) },
                        "400": { "value": tint(base, 0.2) },
                        "500": { "value": base },
                        "600": { "value": shade(base, 0.1) }, // Adjusted shading for better contrast
                        "700": { "value": shade(base, 0.2) },
                        "800": { "value": shade(base, 0.3) },
                        "900": { "value": shade(base, 0.4) }
                      }}}
                    };
                    brandPaletteResult.value = JSON.stringify(palette, null, 2);
                    highlightBlock(brandPaletteBlock);
                };

                const lightThemeBlock = ref(null);
                const generateLightTheme = () => {
                    const palette = aiPalette.value;
                    const result = {
                      "color": {
                        "action": {
                          "primary": { "base": { "value": "{color.brand.primary.500.value}" } },
                          "success": { "base": { "value": palette ? palette.success : "#67C23A" } },
                          "warning": { "base": { "value": palette ? palette.warning : "#E6A23C" } },
                          "danger": { "base": { "value": palette ? palette.danger : "#F56C6C" } },
                          "info": { "base": { "value": palette ? palette.info : "#909399" } }
                        },
                        "text": { "primary": { "value": palette ? palette.textColorLight : "#303133" } },
                        "background": { "page": { "value": palette ? palette.pageBackgroundLight : "#f2f3f5" } },
                        "border": { "base": { "value": palette ? palette.borderColorLight : "#dcdfe6" } }
                      }
                    };
                    lightThemeResult.value = JSON.stringify(result, null, 2);
                    highlightBlock(lightThemeBlock);
                    updatePreviewStyles();
                };
                
                const darkThemeBlock = ref(null);
                const generateDarkTheme = () => {
                     const palette = aiPalette.value;
                     const success = palette ? palette.success : "#67C23A";
                     const warning = palette ? palette.warning : "#E6A23C";
                     const danger = palette ? palette.danger : "#F56C6C";
                     const info = palette ? palette.info : "#909399";
                     const result = {
                      "color": {
                        "action": {
                          "primary": { "base": { "value": "{color.brand.primary.400.value}" } },
                           "success": { "base": { "value": tint(success, 0.2) } },
                           "warning": { "base": { "value": tint(warning, 0.2) } },
                           "danger": { "base": { "value": tint(danger, 0.2) } },
                           "info": { "base": { "value": tint(info, 0.2) } }
                        },
                        "text": { "primary": { "value": palette ? palette.textColorDark : "#e5eaf3" } },
                        "background": { "page": { "value": palette ? palette.pageBackgroundDark : "#0a0a0a" } },
                        "border": { "base": { "value": palette ? palette.borderColorDark : "#4c4d4f" } }
                      }
                    };
                    darkThemeResult.value = JSON.stringify(result, null, 2);
                    highlightBlock(darkThemeBlock);
                    updatePreviewStyles();
                };

                const updatePreviewStyles = () => {
                    try {
                        if (
                            !brandPaletteResult.value || !lightThemeResult.value || !darkThemeResult.value ||
                            !brandPaletteResult.value.trim().startsWith('{') ||
                            !lightThemeResult.value.trim().startsWith('{') ||
                            !darkThemeResult.value.trim().startsWith('{')
                        ) {
                            return;
                        }

                        const lightTheme = JSON.parse(lightThemeResult.value);
                        const darkTheme = JSON.parse(darkThemeResult.value);
                        const brandPalette = JSON.parse(brandPaletteResult.value);
                        
                        const resolveValue = (path, themes) => {
                            if (path && path.startsWith('{') && path.endsWith('}')) {
                                const keyPath = path.slice(1, -1).replace('.value', '').split('.');
                                let current = themes[0]; // brandPalette
                                for (const key of keyPath) {
                                    current = current?.[key];
                                }
                                return current?.value || path;
                            }
                            return path;
                        };

                        let lightCSS = ':root {\n';
                        lightCSS += `  --el-color-primary: ${resolveValue(lightTheme.color.action.primary.base.value, [brandPalette])};\n`;
                        lightCSS += `  --el-color-success: ${lightTheme.color.action.success.base.value};\n`;
                        lightCSS += `  --el-color-warning: ${lightTheme.color.action.warning.base.value};\n`;
                        lightCSS += `  --el-color-danger: ${lightTheme.color.action.danger.base.value};\n`;
                        lightCSS += `  --el-color-info: ${lightTheme.color.action.info.base.value};\n`;
                        lightCSS += `  --el-text-color-primary: ${lightTheme.color.text.primary.value};\n`;
                        lightCSS += `  --el-bg-color-page: ${lightTheme.color.background.page.value};\n`;
                        lightCSS += `  --el-border-color: ${lightTheme.color.border.base.value};\n`;
                        lightCSS += '}\n';
                        document.getElementById('light-theme-styles').innerHTML = lightCSS;

                        let darkCSS = 'html.dark {\n';
                        darkCSS += `  --el-color-primary: ${resolveValue(darkTheme.color.action.primary.base.value, [brandPalette])};\n`;
                        darkCSS += `  --el-color-success: ${darkTheme.color.action.success.base.value};\n`;
                        darkCSS += `  --el-color-warning: ${darkTheme.color.action.warning.base.value};\n`;
                        darkCSS += `  --el-color-danger: ${darkTheme.color.action.danger.base.value};\n`;
                        darkCSS += `  --el-color-info: ${darkTheme.color.action.info.base.value};\n`;
                        darkCSS += `  --el-text-color-primary: ${darkTheme.color.text.primary.value};\n`;
                        darkCSS += `  --el-bg-color-page: ${darkTheme.color.background.page.value};\n`;
                        darkCSS += `  --el-border-color: ${darkTheme.color.border.base.value};\n`;
                        darkCSS += '}\n';
                         document.getElementById('dark-theme-styles').innerHTML = darkCSS;

                    } catch(e) {
                         console.error("Failed to update preview styles:", e);
                    }
                };
                
                const handleColorPickerChange = () => {
                    generateBrandPalette();
                    generateLightTheme();
                    generateDarkTheme();
                }

                // Gemini API Call
                const askAiForPalette = async () => {
                    if (!themePrompt.value) {
                        alert('请输入主题描述！');
                        return;
                    }
                    isLoading.value = true;
                    aiRationale.value = '';
                    aiPalette.value = null;

                    const apiKey = "AIzaSyA2gxEP3ynvtyCiKgcIDAFH1dpBgYGzi14"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const systemPrompt = `You are an expert UI/UX designer specializing in creating beautiful, accessible, and modern color palettes. Your task is to generate a color palette in JSON format based on the user's description. The JSON object must strictly adhere to the provided schema. The hex codes must be valid 6-digit hex codes starting with #. Provide a brief 'rationale' explaining your choices.`;

                    const payload = {
                        contents: [{ parts: [{ text: themePrompt.value }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    primary: { type: "STRING", description: "The main brand color in hex format. E.g., #409EFF" },
                                    success: { type: "STRING", description: "Color for success states. E.g., #67C23A" },
                                    warning: { type: "STRING", description: "Color for warning states. E.g., #E6A23C" },
                                    danger: { type: "STRING", description: "Color for danger/error states. E.g., #F56C6C" },
                                    info: { type: "STRING", description: "Color for informational states. E.g., #909399" },
                                    pageBackgroundLight: { type: "STRING", description: "Page background color for light theme. E.g., #f2f3f5" },
                                    pageBackgroundDark: { type: "STRING", description: "Page background color for dark theme. E.g., #0a0a0a" },
                                    textColorLight: { type: "STRING", description: "Primary text color for light theme. E.g., #303133" },
                                    textColorDark: { type: "STRING", description: "Primary text color for dark theme. E.g., #e5eaf3" },
                                    borderColorLight: { type: "STRING", description: "Default border color for light theme. E.g., #dcdfe6" },
                                    borderColorDark: { type: "STRING", description: "Default border color for dark theme. E.g., #4c4d4f" },
                                    rationale: { type: "STRING", description: "A brief, 2-3 sentence explanation of why these colors were chosen to fit the user's theme description." }
                                },
                                required: ["primary", "success", "warning", "danger", "info", "pageBackgroundLight", "pageBackgroundDark", "textColorLight", "textColorDark", "borderColorLight", "borderColorDark", "rationale"]
                            }
                        }
                    };

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!response.ok) {
                            const errorBody = await response.text();
                            throw new Error(`HTTP error! status: ${response.status}, body: ${errorBody}`);
                        }
                        const result = await response.json();
                        if (result.candidates && result.candidates[0].content.parts[0].text) {
                            const jsonText = result.candidates[0].content.parts[0].text;
                            const parsedJson = JSON.parse(jsonText);
                            aiPalette.value = parsedJson;
                            aiRationale.value = parsedJson.rationale;
                            brandColor.value = parsedJson.primary;
                            generateBrandPalette();
                            generateLightTheme();
                            generateDarkTheme();
                        } else {
                             throw new Error("AI response was empty or malformed.");
                        }
                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                        aiRationale.value = `请求AI调色板失败: ${error.message}`;
                    } finally {
                        isLoading.value = false;
                    }
                };

                const buildScriptBlock = ref(null);
                onMounted(() => {
                    lucide.createIcons();
                    highlightBlock(buildScriptBlock);
                    generateBrandPalette();
                    generateLightTheme();
                    generateDarkTheme();
                });

                return {
                    brandColor, scssAnalysisResult, brandPaletteResult, lightThemeResult, darkThemeResult,
                    themePrompt, aiRationale, isLoading,
                    runScssAnalysis, generateBrandPalette, generateLightTheme, generateDarkTheme,
                    askAiForPalette, handleColorPickerChange,
                    scssResultBlock, brandPaletteBlock, lightThemeBlock, darkThemeBlock, buildScriptBlock,
                };
            }
        }).mount('#app');

        // Vue App for Preview Area
        createApp({
            setup() {
                const isDarkMode = ref(document.documentElement.classList.contains('dark'));
                const inputValue = ref('');
                const toggleTheme = () => { document.documentElement.classList.toggle('dark', isDarkMode.value); };
                onMounted(() => {
                   const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                   if (prefersDark) {
                       isDarkMode.value = true;
                       toggleTheme();
                   }
                });
                return { isDarkMode, inputValue, toggleTheme };
            }
        }).use(ElementPlus).mount('#preview-app');
    </script>
</body>
</html>


