          {
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Figma Raw Export Schema",
  "description": "用于存档 Figma 节点元数据的原始 JSON（raw.json）的结构定义。解除 403 后抓取结果应符合此结构，便于可追踪、可比对、可映射。",
  "type": "object",
  "required": ["fileKey", "capturedAt", "nodes"],
  "properties": {
    "fileKey": {
      "type": "string",
      "description": "Figma 文件的 fileKey，例如 lXOwmixlbhaJZWc4w2pk1s"
    },
    "fileName": {
      "type": "string",
      "description": "Figma 文件名（可选，便于审阅）"
    },
    "capturedAt": {
      "type": "string",
      "format": "date-time",
      "description": "抓取时间 ISO 字符串"
    },
    "captureTool": {
      "type": "string",
      "description": "抓取工具来源（如 MCP: Figma-Context-MCP@get_figma_data）"
    },
    "scope": {
      "type": "object",
      "description": "抓取范围说明",
      "properties": {
        "nodeId": {
          "type": "string",
          "description": "指定抓取的根节点 ID（如 1:1220）。为空表示全文件或其它范围。"
        },
        "depth": {
          "type": "integer",
          "description": "抓取深度（可选）"
        }
      },
      "additionalProperties": false
    },
    "nodes": {
      "type": "array",
      "description": "按 DFS 或 BFS 扁平化的节点列表（每个节点含关键 UI 属性，避免冗余过多）",
      "items": {
        "type": "object",
        "required": ["id", "name", "type", "size"],
        "properties": {
          "id": { "type": "string", "description": "Figma 节点 ID（如 1:1220）" },
          "name": { "type": "string", "description": "节点名称（用于命名与分类）" },
          "type": { "type": "string", "description": "节点类型（FRAME, COMPONENT, COMPONENT_SET, INSTANCE, TEXT, VECTOR, GROUP, RECTANGLE, ELLIPSE, LINE, BOOLEAN_OPERATION...）" },
          "componentKey": { "type": "string", "description": "若为组件/实例，组件 key（可选）" },
          "variantProps": {
            "type": "object",
            "description": "若为变体，记录变体属性（如 size=md, state=hover, theme=light）",
            "additionalProperties": { "type": "string" }
          },
          "parentId": { "type": "string", "description": "父节点 ID（可选）" },
          "childrenIds": {
            "type": "array",
            "description": "子节点 ID 列表（可选）",
            "items": { "type": "string" }
          },
          "size": {
            "type": "object",
            "properties": {
              "width": { "type": "number" },
              "height": { "type": "number" }
            },
            "required": ["width", "height"]
          },
          "layout": {
            "type": "object",
            "description": "自动布局与内边距、间距摘要",
            "properties": {
              "layoutMode": { "type": "string", "enum": ["NONE", "HORIZONTAL", "VERTICAL"] },
              "primaryAxisSizingMode": { "type": "string", "enum": ["FIXED", "AUTO"] },
              "counterAxisSizingMode": { "type": "string", "enum": ["FIXED", "AUTO"] },
              "itemSpacing": { "type": "number" },
              "paddingTop": { "type": "number" },
              "paddingRight": { "type": "number" },
              "paddingBottom": { "type": "number" },
              "paddingLeft": { "type": "number" }
            },
            "additionalProperties": true
          },
          "constraints": {
            "type": "object",
            "description": "约束设置（可选，摘要）",
            "additionalProperties": true
          },
          "fills": {
            "type": "array",
            "description": "填充（仅摘要必要字段）",
            "items": { "$ref": "#/$defs/paint" }
          },
          "strokes": {
            "type": "array",
            "description": "描边（仅摘要必要字段）",
            "items": { "$ref": "#/$defs/paint" }
          },
          "strokeWeight": { "type": "number" },
          "cornerRadius": {
            "description": "统一圆角或四角圆角",
            "oneOf": [
              { "type": "number" },
              {
                "type": "object",
                "properties": {
                  "topLeft": { "type": "number" },
                  "topRight": { "type": "number" },
                  "bottomRight": { "type": "number" },
                  "bottomLeft": { "type": "number" }
                },
                "additionalProperties": false
              }
            ]
          },
          "effects": {
            "type": "array",
            "description": "阴影/模糊效果",
            "items": { "$ref": "#/$defs/effect" }
          },
          "typography": {
            "$ref": "#/$defs/typography",
            "description": "文本样式摘要（仅 TEXT 节点或具有文本样式的组件）"
          },
          "styles": {
            "type": "object",
            "description": "关联样式 ID（Figma 颜色/文本/效果样式）",
            "properties": {
              "fill": { "type": "string" },
              "stroke": { "type": "string" },
              "effect": { "type": "string" },
              "text": { "type": "string" }
            },
            "additionalProperties": false
          },
          "isIcon": { "type": "boolean", "description": "是否判定为图标（用于图标清单生成）" },
          "tags": { "type": "array", "items": { "type": "string" }, "description": "标签/分类辅助" },
          "exportSettings": {
            "type": "array",
            "description": "导出设置（可选）",
            "items": { "type": "object", "additionalProperties": true }
          },
          "tokenCandidates": {
            "type": "array",
            "description": "从节点推断出的潜在 Token 建议（用于落地映射）",
            "items": { "$ref": "#/$defs/tokenCandidate" }
          }
        },
        "additionalProperties": true
      }
    },
    "images": {
      "type": "object",
      "description": "可选：imageRef → 下载 URL 的映射（若抓取工具提供）",
      "additionalProperties": { "type": "string" }
    }
  },
  "$defs": {
    "color": {
      "type": "object",
      "properties": {
        "r": { "type": "number", "minimum": 0, "maximum": 1 },
        "g": { "type": "number", "minimum": 0, "maximum": 1 },
        "b": { "type": "number", "minimum": 0, "maximum": 1 },
        "a": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "required": ["r", "g", "b"],
      "additionalProperties": false
    },
    "paint": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["SOLID", "GRADIENT_LINEAR", "GRADIENT_RADIAL", "GRADIENT_ANGULAR", "GRADIENT_DIAMOND", "IMAGE"]
        },
        "visible": { "type": "boolean" },
        "opacity": { "type": "number" },
        "color": { "$ref": "#/$defs/color" },
        "gradientStops": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "position": { "type": "number" },
              "color": { "$ref": "#/$defs/color" }
            },
            "required": ["position", "color"],
            "additionalProperties": false
          }
        },
        "imageRef": { "type": "string" }
      },
      "required": ["type"],
      "additionalProperties": true
    },
    "effect": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["DROP_SHADOW", "INNER_SHADOW", "LAYER_BLUR", "BACKGROUND_BLUR"]
        },
        "visible": { "type": "boolean" },
        "radius": { "type": "number" },
        "offset": {
          "type": "object",
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" }
          },
          "additionalProperties": false
        },
        "spread": { "type": "number" },
        "color": { "$ref": "#/$defs/color" }
      },
      "required": ["type"],
      "additionalProperties": true
    },
    "typography": {
      "type": "object",
      "properties": {
        "fontFamily": { "type": "string" },
        "fontPostScriptName": { "type": "string" },
        "fontWeight": { "type": "number" },
        "fontSize": { "type": "number" },
        "lineHeightPx": { "type": "number" },
        "lineHeightPercent": { "type": "number" },
        "letterSpacing": { "type": "number" },
        "textCase": { "type": "string" },
        "textDecoration": { "type": "string" }
      },
      "additionalProperties": true
    },
    "tokenCandidate": {
      "type": "object",
      "properties": {
        "kind": {
          "type": "string",
          "enum": ["color", "spacing", "radius", "shadow", "typography", "component"]
        },
        "source": { "type": "string", "description": "来源（如 node.name / style.id / fill.color 等）" },
        "proposedPath": {
          "type": "string",
          "description": "建议映射到 tokens 的路径，如 base.color.brand.primary.500 或 components.button.solid.color.bg.default"
        },
        "value": { "type": ["string", "number", "object", "array", "boolean", "null"] },
        "notes": { "type": "string" }
      },
      "required": ["kind", "proposedPath"],
      "additionalProperties": false
    }
  }
}
